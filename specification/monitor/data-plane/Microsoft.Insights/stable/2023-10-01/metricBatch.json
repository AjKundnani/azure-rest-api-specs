{
  "swagger": "2.0",
  "info": {
    "title": "Azure Monitor Metric Batch",
    "version": "2023-10-01"
  },
  "securityDefinitions": {
    "AADToken": {
      "type": "oauth2",
      "tokenUrl": "https://login.microsoftonline.com/common/oauth2/v2.0/token",
      "flow": "application",
      "description": "Azure Active Directory OAuth2 Authentication",
      "scopes": {
        "https://metrics.monitor.azure.com/.default": "https://metrics.monitor.azure.com/.default"
      }
    }
  },
  "security": [
    {
      "AADToken": [
        "https://metrics.monitor.azure.com/.default"
      ]
    }
  ],
  "x-ms-parameterized-host": {
    "hostTemplate": "{endpoint}",
    "useSchemePrefix": false,
    "positionInOperation": "first",
    "parameters": [
      {
        "name": "endpoint",
        "description": "The regional endpoint to use, for example https://eastus.metrics.monitor.azure.com. The region should match the region of the requested resources. For global resources, the region should be 'global'.",
        "required": true,
        "type": "string",
        "in": "path",
        "x-ms-skip-url-encoding": true,
        "x-ms-parameter-location": "client"
      }
    ]
  },
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/subscriptions/{subscriptionId}/metrics:getBatch": {
      "post": {
        "tags": [
          "Metrics"
        ],
        "operationId": "Metrics_Batch",
        "description": "Lists the metric values for multiple resources.",
        "parameters": [
          {
            "$ref": "#/parameters/MetricBatchSubscriptionIdParameter"
          },
          {
            "$ref": "#/parameters/MetricBatchStartTimeParameter"
          },
          {
            "$ref": "#/parameters/MetricBatchEndTimeParameter"
          },
          {
            "$ref": "#/parameters/MetricBatchIntervalParameter"
          },
          {
            "$ref": "#/parameters/MetricBatchNamespaceParameter"
          },
          {
            "$ref": "#/parameters/MetricBatchNamesParameter"
          },
          {
            "$ref": "../../../../resource-manager/Microsoft.Insights/stable/2021-05-01/metrics_API.json#/parameters/AggregationsParameter"
          },
          {
            "$ref": "../../../../resource-manager/Microsoft.Insights/stable/2021-05-01/metrics_API.json#/parameters/TopParameter"
          },
          {
            "$ref": "../../../../resource-manager/Microsoft.Insights/stable/2021-05-01/metrics_API.json#/parameters/OrderByParameter"
          },
          {
            "$ref": "#/parameters/MetricBatchFilterParameter"
          },
          {
            "$ref": "#/parameters/MetricBatchAutoAdjustTimegrain"
          },
          {
            "$ref": "../../../../../common-types/resource-management/v5/types.json#/parameters/ApiVersionParameter"
          },
          {
            "$ref": "#/parameters/MetricBatchResourceIdListParameter"
          }
        ],
        "responses": {
          "200": {
            "description": "The response to a metrics query.",
            "schema": {
              "$ref": "#/definitions/BatchMetricResultsResponse"
            }
          },
          "default": {
            "description": "Describes the format of Error response.",
            "headers": {
              "x-ms-error-code": {
                "type": "string",
                "description": "Error code for specific error that occurred."
              }
            },
            "schema": {
              "$ref": "../../../../../common-types/resource-management/v5/types.json#/definitions/ErrorResponse"
            }
          }
        },
        "x-ms-examples": {
          "Query Storage Metrics": {
            "$ref": "./examples/MetricBatchExample.json"
          }
        }
      }
    }
  },
  "parameters": {
    "MetricBatchResourceIdListParameter": {
      "name": "resourceIds",
      "in": "body",
      "required": true,
      "schema": {
        "$ref": "#/definitions/MetricBatchResourceIdList"
      },
      "description": "The comma separated list of resource IDs to query metrics for."
    },
    "MetricBatchSubscriptionIdParameter": {
      "name": "subscriptionId",
      "in": "path",
      "required": true,
      "type": "string",
      "format": "uuid",
      "description": "The subscription identifier for the resources in this batch.",
      "x-ms-parameter-location": "method"
    },
    "MetricBatchStartTimeParameter": {
      "name": "starttime",
      "in": "query",
      "required": false,
      "type": "string",
      "format": "date-time",
      "description": "The start time of the query. It is a string in the format 'yyyy-MM-ddTHH:mm:ss.fffZ'. If you have specified the endtime parameter, then this parameter is required.\nIf only starttime is specified, then endtime defaults to the current time.\nIf no time interval is specified, the default is 1 hour.",
      "x-ms-parameter-location": "method"
    },
    "MetricBatchEndTimeParameter": {
      "name": "endtime",
      "in": "query",
      "required": false,
      "type": "string",
      "format": "date-time",
      "description": "The end time of the query. It is a string in the format 'yyyy-MM-ddTHH:mm:ss.fffZ'.",
      "x-ms-parameter-location": "method"
    },
    "MetricBatchIntervalParameter": {
      "name": "interval",
      "in": "query",
      "required": false,
      "type": "string",
      "default": "PT1M",
      "description": "The interval (i.e. timegrain) of the query in ISO 8601 duration format. Defaults to PT1M. Special case for 'FULL' value that returns single datapoint for entire time span requested.\n*Examples: PT15M, PT1H, P1D*, FULL",
      "x-ms-parameter-location": "method"
    },
    "MetricBatchNamespaceParameter": {
      "name": "metricnamespace",
      "in": "query",
      "required": true,
      "type": "string",
      "description": "Metric namespace that contains the requested metric names.",
      "x-ms-parameter-location": "method"
    },
    "MetricBatchNamesParameter": {
      "name": "metricnames",
      "in": "query",
      "required": true,
      "type": "array",
      "items": {
        "type": "string"
      },
      "collectionFormat": "csv",
      "description": "The names of the metrics (comma separated) to retrieve.",
      "x-ms-parameter-location": "method"
    },
    "MetricBatchFilterParameter": {
      "name": "filter",
      "in": "query",
      "required": false,
      "type": "string",
      "description": "The filter is used to reduce the set of metric data returned.<br>Example:<br>Metric contains metadata A, B and C.<br>- Return all time series of C where A = a1 and B = b1 or b2<br>**filter=A eq ‘a1’ and B eq ‘b1’ or B eq ‘b2’ and C eq ‘*’**<br>- Invalid variant:<br>**filter=A eq ‘a1’ and B eq ‘b1’ and C eq ‘*’ or B = ‘b2’**<br>This is invalid because the logical or operator cannot separate two different metadata names.<br>- Return all time series where A = a1, B = b1 and C = c1:<br>**filter=A eq ‘a1’ and B eq ‘b1’ and C eq ‘c1’**<br>- Return all time series where A = a1<br>**filter=A eq ‘a1’ and B eq ‘*’ and C eq ‘*’**.",
      "x-ms-parameter-location": "method"
    },
    "MetricBatchAutoAdjustTimegrain": {
      "name": "autoAdjustTimegrain",
      "in": "query",
      "required": false,
      "type": "boolean",
      "description": "When set to true, if the timespan passed in is not supported by this metric, the API will return the result using the closest supported timespan. When set to false, an error is returned for invalid timespan parameters. Defaults to false.",
      "x-ms-parameter-location": "method"
    }
  },
  "definitions": {
    "MetricBatchResourceIdList": {
      "description": "The comma separated list of resource IDs to query metrics for.",
      "type": "object",
      "properties": {
        "resourceids": {
          "description": "The list of resource IDs to query metrics for.",
          "type": "array",
          "items": {
            "type": "string",
            "format": "arm-id"
          }
        }
      },
      "example": {
        "resourceids": [
          "/subscriptions/123456728-abcd-1234-abcd-123456789abc/resourceGroups/TestGroup/providers/Microsoft.Storage/storageAccounts/TestStorage1",
          "/subscriptions/123456728-abcd-1234-abcd-123456789abc/resourceGroups/TestGroup/providers/Microsoft.Storage/storageAccounts/TestStorage2"
        ]
      }
    },
    "BatchMetricResultsResponse": {
      "description": "The metrics result for a resource.",
      "type": "object",
      "properties": {
        "values": {
          "description": "The collection of metric data responses per resource, per metric.",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "starttime": {
                "type": "string",
                "description": "The start time, in datetime format, for which the data was retrieved."
              },
              "endtime": {
                "type": "string",
                "description": "The end time, in datetime format, for which the data was retrieved."
              },
              "interval": {
                "type": "string",
                "format": "duration",
                "description": "The interval (window size) for which the metric data was returned in. Follows the IS8601/RFC3339 duration format (e.g. 'P1D' for 1 day). This may be adjusted in the future and returned back from what was originally requested.  This is not present if a metadata request was made."
              },
              "namespace": {
                "type": "string",
                "description": "The namespace of the metrics been queried"
              },
              "resourceregion": {
                "type": "string",
                "description": "The region of the resource been queried for metrics."
              },
              "resourceid": {
                "type": "string",
                "description": "The resource that has been queried for metrics."
              },
              "value": {
                "type": "array",
                "items": {
                  "$ref": "../../../../resource-manager/Microsoft.Insights/stable/2021-05-01/metrics_API.json#/definitions/SubscriptionScopeMetric"
                },
                "description": "The value of the collection."
              }
            },
            "required": [
              "starttime",
              "endtime",
              "value"
            ]
          },
          "x-ms-identifiers": [
            "resourceid"
          ]
        }
      }
    }
  }
}
